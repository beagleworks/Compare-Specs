# QuickStart: 振替伝票作成Webアプリケーション

**目的**: 実装後のアプリケーションの動作確認と基本的な使用方法  
**対象**: 開発者、テスター、エンドユーザー  
**所要時間**: 15-20分

## 前提条件

### 技術要件
- Deno 1.37+ がインストール済み
- Node.js 18+ がインストール済み (フロントエンド用)
- SQLite 3.43+ が利用可能
- モダンブラウザ (Chrome, Firefox, Safari, Edge)

### 起動前チェック
```bash
# Deno バージョン確認
deno --version

# Node.js バージョン確認
node --version

# SQLite バージョン確認
sqlite3 --version

# Git リポジトリ確認
git status
```

## セットアップ手順

### 1. 環境準備
```bash
# プロジェクトルートに移動
cd /path/to/furikae-denpyo-webapp

# 依存関係の確認
ls backend/ frontend/

# データベース初期化
cd backend
sqlite3 database/furikae_denpyo.db < database/schema.sql
```

### 2. バックエンド起動
```bash
# バックエンドディレクトリで実行
cd backend
deno run --allow-net --allow-read --allow-write src/main.ts

# 起動確認（別ターミナル）
curl http://localhost:8000/api/accounts
# レスポンス: 勘定科目一覧のJSON
```

### 3. フロントエンド起動
```bash
# フロントエンドディレクトリで実行（別ターミナル）
cd frontend
npm install
npm run dev

# ブラウザで確認
# http://localhost:5173 にアクセス
```

## 基本操作フロー

### シナリオ1: 初回利用とパスワード設定

1. **アプリケーションアクセス**
   ```
   ブラウザで http://localhost:5173 にアクセス
   → パスワード設定画面が表示される
   ```

2. **パスワード設定**
   ```
   パスワード入力欄に「test1234」を入力
   「設定」ボタンをクリック
   → メイン画面に遷移
   ```

3. **認証状態確認**
   ```
   ブラウザを一度閉じて再度アクセス
   → パスワード入力画面が表示される
   「test1234」を入力してログイン
   → メイン画面に遷移
   ```

### シナリオ2: 振替伝票作成（電車代立替）

1. **新規作成開始**
   ```
   メイン画面で「新規作成」ボタンをクリック
   → 振替伝票入力フォームが表示される
   ```

2. **基本情報入力**
   ```
   日付: 2025-09-04（デフォルト値）
   番号: TEST001（任意）
   ```

3. **借方エントリ入力**
   ```
   借方セクションで「+」ボタンをクリック
   勘定科目: 「旅費交通費」を選択
   金額: 500
   摘要: 「新宿→品川 電車代」
   ```

4. **貸方エントリ入力**
   ```
   貸方セクションで「+」ボタンをクリック
   勘定科目: 「現金」を選択
   金額: 500
   摘要: 「立替払い」
   ```

5. **残高確認**
   ```
   画面下部の残高表示を確認
   借方合計: 500円
   貸方合計: 500円
   差額: 0円（一致）
   → 保存ボタンが有効化される
   ```

6. **保存実行**
   ```
   「保存」ボタンをクリック
   → 成功メッセージ表示
   → 振替伝票一覧画面に遷移
   ```

### シナリオ3: PDF出力

1. **一覧から選択**
   ```
   振替伝票一覧で先ほど作成した伝票を選択
   「PDF出力」ボタンをクリック
   ```

2. **PDF生成確認**
   ```
   PDFダウンロード画面が表示される
   ファイル名: furikae-denpyo-20250904-TEST001.pdf
   「ダウンロード」をクリック
   ```

3. **PDF内容確認**
   ```
   ダウンロードしたPDFを開く
   以下の内容が正しく表示されているか確認:
   - 日付: 2025-09-04
   - 番号: TEST001
   - 借方: 旅費交通費 500円 新宿→品川 電車代
   - 貸方: 現金 500円 立替払い
   - 合計: 各500円
   ```

### シナリオ4: カスタム勘定科目の使用

1. **新規伝票作成**
   ```
   「新規作成」ボタンをクリック
   日付: 2025-09-04
   番号: TEST002
   ```

2. **カスタム科目使用**
   ```
   借方エントリで：
   勘定科目: 「その他」を選択
   → カスタム科目入力欄が表示される
   カスタム科目名: 「研修費」を入力
   金額: 3000
   摘要: 「プログラミング研修受講費」
   ```

3. **貸方エントリ**
   ```
   勘定科目: 「普通預金」を選択
   金額: 3000
   摘要: 「振込支払い」
   ```

4. **保存とPDF確認**
   ```
   保存後、PDF出力を実行
   カスタム科目「研修費」が正しく表示されているか確認
   ```

### シナリオ5: バリデーションエラーの確認

1. **不均衡な伝票作成**
   ```
   新規作成で：
   借方: 旅費交通費 1000円
   貸方: 現金 500円
   → 残高表示: 差額 500円
   → 保存ボタンが無効状態
   → エラーメッセージ表示
   ```

2. **必須項目エラー**
   ```
   摘要を空白にして保存を試行
   → フィールドエラーメッセージ表示
   → 保存が実行されない
   ```

3. **金額範囲エラー**
   ```
   金額に0または負の値を入力
   → 入力エラーメッセージ表示
   → 保存が実行されない
   ```

## API動作確認

### cURLでのテスト
```bash
# 勘定科目一覧取得
curl -X GET http://localhost:8000/api/accounts

# 振替伝票一覧取得
curl -X GET http://localhost:8000/api/denpyo

# 新規振替伝票作成
curl -X POST http://localhost:8000/api/denpyo \
  -H "Content-Type: application/json" \
  -d '{
    "date": "2025-09-04",
    "number": "API001",
    "entries": [
      {
        "side": "debit",
        "account_id": "550e8400-e29b-41d4-a716-446655440044",
        "amount": 1000,
        "description": "API テスト - 交通費"
      },
      {
        "side": "credit", 
        "account_id": "550e8400-e29b-41d4-a716-446655440000",
        "amount": 1000,
        "description": "API テスト - 現金支払い"
      }
    ]
  }'
```

## パフォーマンス確認

### レスポンス時間測定
```bash
# API レスポンス時間
time curl -X GET http://localhost:8000/api/accounts
# 期待値: <200ms

# PDF生成時間（作成済み伝票IDを使用）
time curl -X GET http://localhost:8000/api/denpyo/{id}/pdf -o test.pdf
# 期待値: <2s
```

### メモリ使用量確認
```bash
# Deno プロセスのメモリ使用量
ps aux | grep deno
# 期待値: <100MB (通常運用時)

# SQLite データベースサイズ
ls -lh backend/database/furikae_denpyo.db
# 期待値: <1MB (100件程度の伝票)
```

## トラブルシューティング

### よくある問題

1. **ポート競合エラー**
   ```bash
   Error: Address already in use (os error 48)
   → 他のプロセスがポートを使用中
   解決: lsof -ti:8000 | xargs kill
   ```

2. **データベース接続エラー**
   ```bash
   SQLite error: no such file or directory
   → データベースファイルが存在しない
   解決: schema.sqlを再実行
   ```

3. **CORS エラー**
   ```
   フロントエンドからAPIアクセス時のCORSエラー
   → Honoでのcors()ミドルウェア設定確認
   ```

4. **日本語文字化け**
   ```
   PDF内の日本語が文字化け
   → jsPDFのフォント設定確認
   ```

### ログ確認
```bash
# バックエンドログ
tail -f backend/logs/app.log

# フロントエンド開発サーバーログ
# ターミナル出力を確認

# SQLiteクエリログ（必要に応じて）
sqlite3 backend/database/furikae_denpyo.db ".log stdout"
```

## 受け入れ基準チェックリスト

### 機能要件
- [ ] 振替伝票の新規作成ができる
- [ ] 借方・貸方の金額バランスチェックが動作する
- [ ] 勘定科目の選択（プルダウン + カスタム）ができる
- [ ] PDF出力機能が動作する
- [ ] 振替伝票の一覧表示ができる
- [ ] 振替伝票の編集ができる
- [ ] 振替伝票の削除ができる
- [ ] パスワード保護機能が動作する

### 非機能要件
- [ ] API レスポンス時間 <500ms
- [ ] PDF 生成時間 <2秒
- [ ] 日本語表示が正常
- [ ] ブラウザ互換性 (Chrome, Firefox, Safari, Edge)
- [ ] データの永続化が正常

### ユーザビリティ
- [ ] エラーメッセージが分かりやすい
- [ ] 入力フォームの使いやすさ
- [ ] PDF の見た目が適切
- [ ] パフォーマンスが体感的に問題ない

---

**QuickStart完了**: 上記すべての手順とチェックリストが問題なく完了すれば、アプリケーションは正常に動作しています。
